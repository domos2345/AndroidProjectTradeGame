From 600599a47ccff033b3843d2628650aeb81d12fb9 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Jakub=20D=C5=BEama?= <jakubdzama@gmail.com>
Date: Mon, 6 Jun 2022 23:40:35 +0200
Subject: [PATCH] wip

---
 app/build.gradle                              |  1 +
 .../vma_project_2022_trade_game/Game.kt       | 12 +---
 .../vma_project_2022_trade_game/GameDTO.kt    | 68 ++++++++++++++++---
 .../GridItemModel.kt                          | 37 +++++++++-
 .../MainMenuViewModel.kt                      |  7 --
 .../main_menu/GamesRecyclerView.kt            |  4 ++
 .../{ => main_menu}/MainMenuFragment.kt       | 17 +++--
 .../main_menu/MainMenuViewModel.kt            | 31 +++++++++
 .../main/res/layout/fragment_main_menu.xml    |  2 +-
 app/src/main/res/navigation/my_nav.xml        |  2 +-
 12 files changed, 150 insertions(+), 36 deletions(-)
 delete mode 100644 app/src/main/java/com/example/vma_project_2022_trade_game/MainMenuViewModel.kt
 create mode 100644 app/src/main/java/com/example/vma_project_2022_trade_game/main_menu/GamesRecyclerView.kt
 rename app/src/main/java/com/example/vma_project_2022_trade_game/{ => main_menu}/MainMenuFragment.kt (78%)
 create mode 100644 app/src/main/java/com/example/vma_project_2022_trade_game/main_menu/MainMenuViewModel.kt

diff --git a/app/build.gradle b/app/build.gradle
index a653a2a..831cecd 100644
--- a/app/build.gradle
+++ b/app/build.gradle
@@ -56,6 +56,7 @@ dependencies {
     implementation 'androidx.legacy:legacy-support-v4:1.0.0'
     implementation 'androidx.lifecycle:lifecycle-livedata-ktx:2.3.1'
     implementation 'androidx.lifecycle:lifecycle-viewmodel-ktx:2.3.1'
+    implementation "androidx.fragment:fragment-ktx:1.1.0"
     implementation 'com.google.firebase:firebase-database-ktx:20.0.5'
     implementation 'androidx.navigation:navigation-fragment-ktx:2.4.2'
     implementation 'androidx.navigation:navigation-ui-ktx:2.4.2'
diff --git a/app/src/main/java/com/example/vma_project_2022_trade_game/Game.kt b/app/src/main/java/com/example/vma_project_2022_trade_game/Game.kt
index 612fe6d..71da632 100644
--- a/app/src/main/java/com/example/vma_project_2022_trade_game/Game.kt
+++ b/app/src/main/java/com/example/vma_project_2022_trade_game/Game.kt
@@ -6,14 +6,8 @@ class Game(
     val resNames: Map<String, String>,
     val maxRatio: Int,
     val isOnlyOneToX: Boolean,
-
-    ) {
-
-    //val tables: ArrayList<Map<String, GridItemModel>> = arrayListOf()
-    var tables: MutableMap<String, MutableMap<String, GridItemModel>> =
-        mutableMapOf<String, MutableMap<String, GridItemModel>>()
-    //val tables: MutableMap<String, Map<String, String>> = mutableMapOf()
-
+    val tables: MutableMap<String, MutableMap<String, GridItemModel>> = mutableMapOf()
+) {
 
     fun generateGridItems(phase: Int) {
         var tableAct: MutableMap<String, GridItemModel> = mutableMapOf<String, GridItemModel>()
@@ -60,7 +54,7 @@ class Game(
     }
 
     override fun toString(): String {
-        return "Game(nameOfGame='$nameOfGame', resCount=$resCount, resNames=$resNames, maxRatio=$maxRatio, isOnlyOneToX=$isOnlyOneToX)"
+        return "Game(nameOfGame='$nameOfGame', resCount=$resCount, resNames=$resNames, maxRatio=$maxRatio, isOnlyOneToX=$isOnlyOneToX), tables=$tables"
     }
 
     fun getGameDTO(): GameDTO {
diff --git a/app/src/main/java/com/example/vma_project_2022_trade_game/GameDTO.kt b/app/src/main/java/com/example/vma_project_2022_trade_game/GameDTO.kt
index d142319..680c3b6 100644
--- a/app/src/main/java/com/example/vma_project_2022_trade_game/GameDTO.kt
+++ b/app/src/main/java/com/example/vma_project_2022_trade_game/GameDTO.kt
@@ -1,10 +1,62 @@
 package com.example.vma_project_2022_trade_game
 
-data class GameDTO(
-    val nameOfGame: String,
-    val resCount: Int,
-    val resNames: Map<String, String>,
-    val maxRatio: Int,
-    val isOnlyOneToX: Boolean,
-    val tables: MutableMap<String, MutableMap<String, GridItemModel>>,
-)
\ No newline at end of file
+class GameDTO() {
+    var nameOfGame: String = ""
+    var resCount: Int = 0
+    var resNames: Map<String, String> = mapOf()
+    var maxRatio: Int = 0
+    var isOnlyOneToX: Boolean = false
+    var tables: MutableMap<String, MutableMap<String, GridItemModel>> = mutableMapOf()
+
+    constructor(nameOfGame: String, resCount: Int,resNames: Map<String, String>, maxRatio: Int, isOnlyOneToX: Boolean, tables: MutableMap<String, MutableMap<String, GridItemModel>>) : this() {
+        this.nameOfGame = nameOfGame
+        this.resCount = resCount
+        this.resNames = resNames
+        this.maxRatio = maxRatio
+        this.isOnlyOneToX = isOnlyOneToX
+        this.tables = tables
+    }
+
+    override fun equals(other: Any?): Boolean {
+        if (this === other) return true
+        if (javaClass != other?.javaClass) return false
+
+        other as GameDTO
+
+        if (nameOfGame != other.nameOfGame) return false
+        if (resCount != other.resCount) return false
+        if (resNames != other.resNames) return false
+        if (maxRatio != other.maxRatio) return false
+        if (isOnlyOneToX != other.isOnlyOneToX) return false
+        if (tables != other.tables) return false
+
+        return true
+    }
+
+    override fun hashCode(): Int {
+        var result = nameOfGame.hashCode()
+        result = 31 * result + resCount
+        result = 31 * result + resNames.hashCode()
+        result = 31 * result + maxRatio
+        result = 31 * result + isOnlyOneToX.hashCode()
+        result = 31 * result + tables.hashCode()
+        return result
+    }
+
+    override fun toString(): String {
+        return "GameDTO(nameOfGame='$nameOfGame', resCount=$resCount, resNames=$resNames, maxRatio=$maxRatio, isOnlyOneToX=$isOnlyOneToX, tables=$tables)"
+    }
+
+
+}
+
+fun GameDTO.toGame(): Game {
+    return Game(
+        this.nameOfGame,
+        this.resCount,
+        this.resNames,
+        this.maxRatio,
+        this.isOnlyOneToX,
+        tables
+    )
+}
\ No newline at end of file
diff --git a/app/src/main/java/com/example/vma_project_2022_trade_game/GridItemModel.kt b/app/src/main/java/com/example/vma_project_2022_trade_game/GridItemModel.kt
index 957e2f4..fe43609 100644
--- a/app/src/main/java/com/example/vma_project_2022_trade_game/GridItemModel.kt
+++ b/app/src/main/java/com/example/vma_project_2022_trade_game/GridItemModel.kt
@@ -1,7 +1,42 @@
 package com.example.vma_project_2022_trade_game
 
 
-data class GridItemModel(val intPos: Int, val res1Val: Int, val res2Val: Int)
+class GridItemModel() {
+    var intPos: Int = 0
+    var res1Val: Int = 0
+    var res2Val: Int = 0
+
+    constructor(intPos: Int, res1Val: Int, res2Val: Int): this() {
+        this.intPos = intPos
+        this.res1Val = res1Val
+        this.res2Val = res2Val
+    }
+
+    override fun equals(other: Any?): Boolean {
+        if (this === other) return true
+        if (javaClass != other?.javaClass) return false
+
+        other as GridItemModel
+
+        if (intPos != other.intPos) return false
+        if (res1Val != other.res1Val) return false
+        if (res2Val != other.res2Val) return false
+
+        return true
+    }
+
+    override fun hashCode(): Int {
+        var result = intPos
+        result = 31 * result + res1Val
+        result = 31 * result + res2Val
+        return result
+    }
+
+    override fun toString(): String {
+        return "GridItemModel(intPos=$intPos, res1Val=$res1Val, res2Val=$res2Val)"
+    }
+
+}
 
 /*fun gridItemText(): String = "$res1Val : $res2Val"
 
diff --git a/app/src/main/java/com/example/vma_project_2022_trade_game/MainMenuViewModel.kt b/app/src/main/java/com/example/vma_project_2022_trade_game/MainMenuViewModel.kt
deleted file mode 100644
index 38a78a9..0000000
--- a/app/src/main/java/com/example/vma_project_2022_trade_game/MainMenuViewModel.kt
+++ /dev/null
@@ -1,7 +0,0 @@
-package com.example.vma_project_2022_trade_game
-
-import androidx.lifecycle.ViewModel
-
-class MainMenuViewModel : ViewModel() {
-    // TODO: Implement the ViewModel
-}
\ No newline at end of file
diff --git a/app/src/main/java/com/example/vma_project_2022_trade_game/main_menu/GamesRecyclerView.kt b/app/src/main/java/com/example/vma_project_2022_trade_game/main_menu/GamesRecyclerView.kt
new file mode 100644
index 0000000..fcfabd6
--- /dev/null
+++ b/app/src/main/java/com/example/vma_project_2022_trade_game/main_menu/GamesRecyclerView.kt
@@ -0,0 +1,4 @@
+package com.example.vma_project_2022_trade_game.main_menu
+
+class GamesRecyclerView {
+}
\ No newline at end of file
diff --git a/app/src/main/java/com/example/vma_project_2022_trade_game/MainMenuFragment.kt b/app/src/main/java/com/example/vma_project_2022_trade_game/main_menu/MainMenuFragment.kt
similarity index 78%
rename from app/src/main/java/com/example/vma_project_2022_trade_game/MainMenuFragment.kt
rename to app/src/main/java/com/example/vma_project_2022_trade_game/main_menu/MainMenuFragment.kt
index 87c203c..c03e8d0 100644
--- a/app/src/main/java/com/example/vma_project_2022_trade_game/MainMenuFragment.kt
+++ b/app/src/main/java/com/example/vma_project_2022_trade_game/main_menu/MainMenuFragment.kt
@@ -1,21 +1,20 @@
-package com.example.vma_project_2022_trade_game
+package com.example.vma_project_2022_trade_game.main_menu
 
-import androidx.lifecycle.ViewModelProvider
 import android.os.Bundle
 import androidx.fragment.app.Fragment
 import android.view.LayoutInflater
 import android.view.View
 import android.view.ViewGroup
-import android.widget.Button
+import androidx.fragment.app.viewModels
 import androidx.navigation.Navigation
-import androidx.navigation.fragment.NavHostFragment
-import androidx.navigation.fragment.findNavController
+import com.example.vma_project_2022_trade_game.R
 import com.example.vma_project_2022_trade_game.databinding.FragmentMainMenuBinding
-import com.google.android.material.floatingactionbutton.FloatingActionButton
+import java.util.logging.Logger
 
 class MainMenuFragment : Fragment(R.layout.fragment_main_menu) {
 
-    private lateinit var viewModel: MainMenuViewModel
+    val LOG = Logger.getLogger(this.javaClass.name)
+    private val viewModel by viewModels<MainMenuViewModel>()
     private var _binding: FragmentMainMenuBinding? = null
     private val binding get() = _binding!!
 
@@ -33,6 +32,10 @@ class MainMenuFragment : Fragment(R.layout.fragment_main_menu) {
     override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
         super.onViewCreated(view, savedInstanceState)
 
+        viewModel.games.observe(requireActivity()) { games ->
+            LOG.info(games.toString())
+        }
+
         binding.addGameButton.setOnClickListener {
             Navigation.findNavController(view)
                 .navigate(R.id.action_mainMenuFragment_to_resourceSetupFragment)
diff --git a/app/src/main/java/com/example/vma_project_2022_trade_game/main_menu/MainMenuViewModel.kt b/app/src/main/java/com/example/vma_project_2022_trade_game/main_menu/MainMenuViewModel.kt
new file mode 100644
index 0000000..0e18bca
--- /dev/null
+++ b/app/src/main/java/com/example/vma_project_2022_trade_game/main_menu/MainMenuViewModel.kt
@@ -0,0 +1,31 @@
+package com.example.vma_project_2022_trade_game.main_menu
+
+import androidx.lifecycle.LiveData
+import androidx.lifecycle.MutableLiveData
+import androidx.lifecycle.ViewModel
+import com.example.vma_project_2022_trade_game.Game
+import com.example.vma_project_2022_trade_game.GameDTO
+import com.example.vma_project_2022_trade_game.toGame
+import com.google.firebase.firestore.FirebaseFirestore
+import java.util.logging.Logger
+
+class MainMenuViewModel : ViewModel() {
+
+    val LOG = Logger.getLogger(this.javaClass.name)
+
+    private val _games = MutableLiveData<List<Game>?>()
+    val games: LiveData<List<Game>?>
+        get() = _games
+
+    init {
+        FirebaseFirestore.getInstance().collection("games")
+            .addSnapshotListener { value, error ->
+                if (error != null) {
+                    _games.value = null
+                    return@addSnapshotListener
+                }
+                _games.value = value?.map { doc -> doc.toObject(GameDTO::class.java).toGame() }
+            }
+    }
+
+}
\ No newline at end of file
diff --git a/app/src/main/res/layout/fragment_main_menu.xml b/app/src/main/res/layout/fragment_main_menu.xml
index de9e8c3..ae10c14 100644
--- a/app/src/main/res/layout/fragment_main_menu.xml
+++ b/app/src/main/res/layout/fragment_main_menu.xml
@@ -5,7 +5,7 @@
     android:id="@+id/frameLayout"
     android:layout_width="match_parent"
     android:layout_height="match_parent"
-    tools:context=".MainMenuFragment">
+    tools:context=".main_menu.MainMenuFragment">
 
     <com.google.android.material.floatingactionbutton.FloatingActionButton
         android:id="@+id/addGameButton"
diff --git a/app/src/main/res/navigation/my_nav.xml b/app/src/main/res/navigation/my_nav.xml
index 76dd76a..06cbb9f 100644
--- a/app/src/main/res/navigation/my_nav.xml
+++ b/app/src/main/res/navigation/my_nav.xml
@@ -7,7 +7,7 @@
 
     <fragment
         android:id="@+id/mainMenuFragment"
-        android:name="com.example.vma_project_2022_trade_game.MainMenuFragment"
+        android:name="com.example.vma_project_2022_trade_game.main_menu.MainMenuFragment"
         android:label="fragment_main_menu"
         tools:layout="@layout/fragment_main_menu" >
         <action
-- 
2.27.0.windows.1

